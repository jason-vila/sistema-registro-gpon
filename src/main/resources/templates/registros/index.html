<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="fragments/layout :: layoutBase('Registros RUC1O', 'Listado', ~{::contenido}, ~{})">

<th:block th:fragment="contenido">
    <div class="row">
        <div class="col-12">
            <div class="card mb-4">
                <div class="card-header pb-0 d-flex justify-content-between align-items-center">
                    <h5>
                        <i class="fa-solid fa-id-card me-1"></i>
                        Lista de registros
                    </h5>

                    <a th:href="@{/registros/nuevo}" class="btn btn-primary mb-0">
                        <i class="fas fa-plus me-1"></i>
                        Nuevo
                    </a>
                </div>

                <form method="post" th:action="@{/registros/filtrar}">
                    <div class="row g-2 px-4 pt-3">
                        <select name="estado" th:name="estado" class="form-select form-select-sm" style="width: 200px;" onchange="this.form.submit()">
                            <option value="-1" selected disabled>--SELECCIONAR--</option>
                            <option value="1" th:selected="${param.estado == 1}">Activos</option>
                            <option value="0" th:selected="${param.estado == 0}">Inactivos</option>
                        </select>
                    </div>
                </form>

                <div class="card-body px-3 pt-0 pb-2">
                    <div class="table-responsive">
                        <table id="tabla-registros" class="table align-items-center mb-0 text-center">
                            <thead>
                            <tr>
                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Código</th>
                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Cliente</th>
                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Consultor</th>
                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Supervisor</th>
<!--                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Plan</th>-->
<!--                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Promoción</th>-->
                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Estado</th>
                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">IdSolicitud</th>
                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">IdInstalación</th>
                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">IdCarrito</th>
                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Observación</th>
                                <th class="text-secondary opacity-7"></th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="x : ${listaruc}">
                                <td><span class="badge badge-sm border text-dark" th:text="${x.idRegistro}"></span></td>
                                <td><p class="text-sm text-dark mb-0 text-wrap" style="white-space: normal;" th:text="${x.cliente.nombre + ' ' + x.cliente.apellido}"></p></td>
                                <td><p class="text-sm text-dark mb-0 text-wrap" style="white-space: normal;" th:text="${x.usuarioConsulto.nombre + ' ' + x.usuarioConsulto.apellido}"></p></td>
                                <td><p class="text-sm text-dark mb-0 text-wrap" style="white-space: normal;" th:text="${x.usuarioSupervisor.nombre + ' ' + x.usuarioSupervisor.apellido}"></p></td>
<!--                                <td><p class="text-sm text-dark mb-0 text-wrap" style="white-space: normal;" th:text="${x.plan.descripcion}"></p></td>-->
<!--                                <td><p class="text-sm text-dark mb-0 text-wrap" style="white-space: normal;" th:text="${x.promocion.descripcion}"></p></td>-->
                                <td><p class="text-sm text-dark mb-0 text-wrap" style="white-space: normal;" th:text="${x.estado.descripcion}"></p></td>
                                <td><p class="text-sm text-dark mb-0" th:text="${x.idSolicitud}"></p></td>
                                <td><p class="text-sm text-dark mb-0" th:text="${x.idInstalacion}"></p></td>
                                <td><p class="text-sm text-dark mb-0" th:text="${x.idCarrito}"></p></td>
                                <td><p class="text-sm text-dark mb-0 text-wrap" style="white-space: normal;" th:text="${x.observacion}"></p></td>
                                <td class="text-center">
                                    <div class="dropdown">
                                        <button class="btn btn-sm btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                            <i class="fa-solid fa-ellipsis-vertical"></i> Acciones
                                        </button>
                                        <ul class="dropdown-menu text-center">
                                            <li>
                                                <a class="dropdown-item text-primary" th:href="@{/registros/actualizar/{id}(id=${x.idRegistro})}">
                                                    <i class="fa-solid fa-pen me-1"></i> Editar
                                                </a>
                                            </li>

<!--                                            <li>-->
<!--                                                <a class="dropdown-item text-secondary" href="#">-->
<!--                                                    <i class="fa-solid fa-id-card me-1"></i> Ver DNI Cliente-->
<!--                                                </a>-->
<!--                                            </li>-->
<!--                                            <li>-->
<!--                                                <a class="dropdown-item text-warning" href="#">-->
<!--                                                    <i class="fa-solid fa-user me-1"></i> Contacto Principal-->
<!--                                                </a>-->
<!--                                            </li>-->
                                            <li>
                                                <a class="dropdown-item text-warning" th:href="@{/registros/detalle/{id}(id=${x.idRegistro})}" >
                                                    <i class="fa-solid fa-user-pen me-1"></i> Detalle
                                                </a>
                                            </li>
                                            <li>
                                                <form method="post" th:action="@{/registros/delete/{id}(id=${x.idRegistro})}" class="dropdown-item px-3">
                                                    <div class="form-switch d-flex align-items-center justify-content-between">
                                                        <label class="me-2 mb-0">Estado</label>
                                                        <input class="form-check-input"
                                                               type="checkbox"
                                                               th:checked="${x.activo == 1}"
                                                               name="activo"
                                                               th:value="${x.activo == 1} ? false : true"
                                                               onchange="confirmarCambioEstado(this)"
                                                               title="Cambiar Estado" />
                                                    </div>
                                                </form>
                                            </li>
                                        </ul>
                                    </div>
                                </td>

                            </tr>
                            <tr th:if="${#lists.isEmpty(listaruc)}">
                                <td colspan="12" class="text-center text-muted py-4">
                                    No hay registros disponibles.
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

<!--                <div class="modal fade" id="modalCronograma" tabindex="-1" aria-labelledby="modalCronogramaLabel" aria-hidden="true">-->
<!--                    <div class="modal-dialog modal-dialog-centered">-->
<!--                        <div class="modal-content">-->
<!--                            <div class="modal-header bg-info text-white">-->
<!--                                <h5 class="modal-title" id="modalCronogramaLabel">-->
<!--                                    <i class="fa-solid fa-calendar-days me-2"></i> Detalle de Cronograma-->
<!--                                </h5>-->
<!--                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>-->
<!--                            </div>-->
<!--                            <div class="modal-body">-->
<!--                                <p><strong>Cliente:</strong> Juan Pérez</p>-->
<!--                                <p><strong>Fecha:</strong> 10 de julio de 2025</p>-->
<!--                                <p><strong>Hora:</strong> 3:00 PM</p>-->
<!--                                <p><strong>Dirección:</strong> Av. Los Álamos 123 - Lima</p>-->
<!--                                <p><strong>Consultor asignado:</strong> Ana Torres</p>-->
<!--                            </div>-->
<!--                            <div class="modal-footer">-->
<!--                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
            </div>
        </div>
    </div>

    <div th:replace="fragments/datatable-script :: datatableScript('tabla-registros')"></div>

    <!-- Alertas y notificaciones -->
    <div th:if="${alert}">
        <div th:utext="${alert}"></div>
    </div>

    <div th:if="${toast}" th:utext="${toast}"></div>
</th:block>
</html>