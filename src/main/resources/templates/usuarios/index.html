<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layoutBase('Usuarios', 'Listado', ~{::contenido})}">
<th:block th:fragment="contenido">

	<div class="row">
		<div class="col-12">
			<div class="card mb-4 shadow-sm">
				<div class="card-header pb-0 d-flex justify-content-between align-items-center">
					<h5 class="fw-bold text-primary mb-0">
						<i class="fa-solid fa-users me-2"></i>
						Lista de usuarios
					</h5>
					<a th:href="@{/usuarios/nuevo}" class="btn btn-primary btn-sm">
						<i class="fas fa-plus me-1"></i>
							Nuevo usuario
					</a>
				</div>
				
				<form method="get" th:action="@{/usuarios/filtrado}" th:object="${filtro}">
					<div class="row g-2 px-4 pt-3">

						<!-- Select de Roles -->
						<div class="col-auto">
							<div class="input-group input-group-sm">
								<span class="input-group-text bg-white border-secondary">
									<i class="fa-solid fa-user-tag text-secondary"></i>
								</span>
								<select class="form-select border-secondary" th:field="*{idRol}" id="idRol" onchange="this.form.submit()">
									<option value="">-- Todos --</option>
									<option th:each="item : ${lstRoles}" th:value="${item.idRol}" th:text="${item.descripcion}"></option>
								</select>
							</div>
						</div>

						<!-- Botón Limpiar -->
						<div class="col-auto">
							<a th:href="@{/usuarios}" class="btn btn-outline-secondary btn-sm d-flex align-items-center">
								<i class="fa-solid fa-arrows-rotate me-1"></i>
								Limpiar
							</a>
						</div>

					</div>
				</form>
				<div class="card-body px-3 pt-0 pb-3">
					<div class="table-responsive">
						<table id="tblUsuarios" class="table table-hover table-striped align-middle">
							<thead class="bg-light">
								<tr>
									<th class="text-center">Código</th>
									<th class="text-center">Nombre</th>
									<th class="text-center">Apellido</th>
									<th class="text-center">Correo</th>
									<th class="text-center">Contraseña</th>
									<th class="text-center">Estado</th>
									<th class="text-center">Rol</th>
									<th class="text-center">Acciones</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="usuario : ${lstUsuarios}">
									<td th:text="${usuario.idUsuario}" class="text-center"></td>
									<td th:text="${usuario.nombre}" class="text-center text-capitalize"></td>
									<td th:text="${usuario.apellido}" class="text-center text-capitalize"></td>
									<td th:text="${usuario.correo}" class="text-center"></td>


									<td class="text-center">
										<span class="text-muted">••••••</span>
									</td>

									<td class="ps-0 text-center">
										<form method="post"
											th:action="@{/usuarios/cambiar-estado/{id}(id=${usuario.idUsuario})}">
											<div class="d-flex align-items-center justify-content-center gap-2">
												<span class="text-sm">Inactivo</span>
												<div class="form-switch">
													<input class="form-check-input" type="checkbox"
														th:checked="${usuario.estado}" onchange="this.form.submit()">
												</div>
												<span class="text-sm">Activo</span>
											</div>
										</form>
									</td>

									<!-- Rol -->
									<td th:text="${usuario.rol.descripcion}" class="text-center text-capitalize"></td>

									<!-- Acciones -->
									<td class="text-center">
										<a th:href="@{'/usuarios/edicion/' + ${usuario.idUsuario}}"
											class="btn btn-sm btn-outline-primary me-2" title="Editar">
											<i class="fa-solid fa-pen"></i>
										</a>

										<a href="javascript:void(0);" class="btn btn-sm btn-outline-danger"
											th:onclick="|confirmarEliminacion(${usuario.idUsuario})|"
											title="Eliminar">
											<i class="fas fa-trash-alt"></i>
										</a>
									</td>
								</tr>

								<!-- Mensaje si no hay usuarios -->
								<tr th:if="${#lists.isEmpty(lstUsuarios)}">
									<td colspan="8" class="text-center text-muted py-4">
										No hay usuarios registrados.
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>

			</div>
		</div>
	</div>

	<!-- SweetAlert para confirmación -->
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script>
		function confirmarEliminacion(id) {
			Swal.fire({
				title: '¿Estás seguro?',
				text: "Esta acción inhabilitará al usuario.",
				icon: 'warning',
				showCancelButton: true,
				confirmButtonColor: '#d33',
				cancelButtonColor: '#3085d6',
				confirmButtonText: 'Confirmar',
				cancelButtonText: 'Cancelar'
			}).then((result) => {
				if (result.isConfirmed) {
					window.location.href = '/usuarios/eliminar/' + id;
				}
			});
		}
			$(document).ready(function () {
				$('#tblUsuarios').DataTable({
					language: {
						url: 'https://cdn.datatables.net/plug-ins/2.0.3/i18n/es-ES.json',
						search: "Filtro general :",
					}
				});
			});
		</script>

	<!-- Mostrar alertas -->
	<div th:utext="${alert}"></div>

</th:block>

</html>